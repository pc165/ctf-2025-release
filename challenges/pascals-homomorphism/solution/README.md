

Flag 1:

    $ ./paillier
    
                                     #
                                    # #
                                   #   #
                                  # # # #
                                 #       #
                                # #     # #
                               #   #   #   #
                              # # # # # # # #
                             #               #
                            # #             # #
                           #   #           #   #
                          # # # #         # # # #
                         #       #       #       #
                        # #     # #     # #     # #
                       #   #   #   #   #   #   #   #
                      # # # # # # # # # # # # # # # #
                     #                               #
                    # #                             # #
                   #   #                           #   #
                  # # # #                         # # # #
                 #       #        Pascal's       #       #
                # #     # #     Homomorphism    # #     # #
               #   #   #   #                   #   #   #   #
              # # # # # # # #                 # # # # # # # #
             #               #               #               #
            # #             # #             # #             # #
           #   #           #   #           #   #           #   #
          # # # #         # # # #         # # # #         # # # #
         #       #       #       #       #       #       #       #
        # #     # #     # #     # #     # #     # #     # #     # #
       #   #   #   #   #   #   #   #   #   #   #   #   #   #   #   #
      # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
    
    New weak key generated (192 bits)
    n: 3844388470133391474161902377612094513682466997898769083581
    g: n + 1
    
    Try "help" for a list of commands
    
    paillier> getflag
    Encrypted flag 1 (weak): 14037216798694959574384150946319159850382277843414803362297145132835955127769909416465103449863997744601756017017706

This can be attacked directly by factoring N.

Using GP/PARI:

    $ gp -q
    
    GP/PARI> modexp(a, b, n) = { \
        my(d, bin); \
        d = Mod(1, n); \
        bin = binary(b); \
        for (i = 1, length(bin), \
             d = sqr(d); \
             if (bin[i] == 1, \
                 d = d*a; \
             ); \
        ); \
        return(d);
    }
    
    GP/PARI> l(x, n) = (x - 1) \ n
    %2 = (x,n)->(x-1)\n
    
    GP/PARI> n = 3844388470133391474161902377612094513682466997898769083581
    %3 = 3844388470133391474161902377612094513682466997898769083581
    GP/PARI> factor(n)
    %4 =
    [60631744889347859434635961229 1]
    
    [63405539081043273571957819889 1]
    
    GP/PARI> p = 60631744889347859434635961229
    %5 = 60631744889347859434635961229
    
    GP/PARI> q = n / p
    %6 = 63405539081043273571957819889
    
    GP/PARI> g = n + 1
    %7 = 3844388470133391474161902377612094513682466997898769083582
    
    GP/PARI> lam = (p - 1)*(q - 1)
    %8 = 3844388470133391474161902377488057229712075864892175302464
    
    GP/PARI> u = lift(Mod(1 / lam, n))
    %9 = 2967748187023108475756496962848623893629047834680750037391
    
    GP/PARI> c = 14037216798694959574384150946319159850382277843414803362297145132835955127769909416465103449863997744601756017017706
    %10 = 14037216798694959574384150946319159850382277843414803362297145132835955127769909416465103449863997744601756017017706
    
    GP/PARI> m = lift(Mod(l(lift(modexp(c, lam, n^2)), n) * u, n))
    %11 = 22910939700329790443863095484608789183754
    
    GP/PARI> strchr(digits(m, 256))
    %12 = "CTF{wut_not_rsa}\n"


Breaking the second flag relies on ciphertext malliability (the Paillier system homomorphism) and the decryption oracle. Briefly, in Paillier, enc(m1) = c1 and enc(m2) = c1 but also enc(m1 + m2) = c1 * c2.

So the idea is this: get the encrypted flag, partially factor the ciphertext. The decrypt each factor to find the corresponding plaintext for each factor. Once all the factors are decrypted, the true message is the sum of all of the factor messeges mod n.

The decryption oracle provided is capped at 2000 bits but factoring the ~2048 encrypted flag should find enough small factors to drop the largest factor below 2000. If it doesn't just fetch the encrypted flag until it does.

    paillier> genkey strong
    New strong key generated (1024 bits)
    n: 136981593347487370987577320035478914561394613962925553975587484279130061127897807891894407134265912887595821840159013570844002433897740551902899655921600054567580586448446664401410498598151974901953052329715219719514772817880500154545956487519270505448885340956960921808358942399917837223819160908982980638833
    g: n + 1
    
    paillier> getflag
    Encrypted flag 2 (strong): 7081712182161291422728776565674843368421208227308856147599959508943597073771616083159000708877404537908608602541428464149382089851205466964528950992320356865653909467834252215049638945622696111307334792547874755205654275024838725532399096799204022595824973469169477605424748183537686859652539813880031275289035894545289395658033762730627554407460132118626305018076424075525697416625021258302808140015171283031616251570355922852888143852282663757047745656930590372458652069779745085049342684845999753718449563933275374199717740340310986791099674969181003176584785833242843983131706709896574731829076614713019636870764
    
    paillier> getflag
    Encrypted flag 2 (strong): 13911437984368101560480458625468708227228710564108218218829618494744917352807228729660572449487677038593974144238965248093813201390684188736256167632255948407887369582389677270404770938909688375469462067373313664900041074894537913364096676356299666814954476228507315787479175396870457317827890270751759376060125078887546912937363525758526139963483590262583417155387816946240014660815637447113994889915380934023260430678951591254418982156712042041192727183005422290582215699656439252357531699928685241520979142428868921643057589157751067668315612281186270596871270963367885913631448845185285789883899553142703497960463
    
    paillier> decrypt
    
    Number, c, to decrypt? 43759
    Plaintext for c: 28593425478267493242206468038704717466635277432585884624592568138590060696281788267295292693929585100809942270800928347900168014946717979919948559346920872628272096193951661239673963109903942403224433139005220490265854540131632437404391108504652879604584388280760299764521478905048034271904489548162148077258
    
    paillier> decrypt
    
    Number, c, to decrypt? 151667
    Plaintext for c: 28294757983311484390305954279736738682626116396678093939397734516137823127402696962374694018073785409132784257328389537132386261264290616530047924311793885953253219469688207025262056295418176929259644183597083458882655684343750657764181971035828894014427533539343448409475942958308103130268589502466250148469
    
    paillier> decrypt
    
    Number, c, to decrypt? 18049349
    Plaintext for c: 119003953228566347195464078434165387149756438171510761436259977130960825650452214550300407298898349423358291276893255020327854588400981662750533690446833603297603489788254114560369834422364311308231233941278290855295835692267983003540510825081169780229262345955998122060364568777573780137830671908355090666267
    
    paillier> decrypt
    
    Number, c, to decrypt? 116132024323457094571330543406887656689880605607462973436783570657002627064631182020404516922341378754371202964765730569277877702515441914257099488804125212478352026987440543274836064475069960415663342761118462237682276189879849485135057256312407117279079732356350348785317356278706933730959386546070352345637198092078821082037381284008796112911278718341073849929539800177985285587503526829635367828032687298811081847884333550318822462302934313436396316116775238819665006944733915611260769795934959968371085560475215856122848967100467756196645826273257812261428998202641931228323933594405182808098079
    Plaintext for c: 98071050004829417147178139318350985823771395925076367950924688772571412781658916003818420257630105841890625875295454236327596003183490844605269137737651747256032367444999345977515143368617519163190793395549844634585199719017634210382948030817115379958263506346295387265012883968136666827481798662789564334482

In this case, the first getflag returned a number that couldn't easily be factored into chunks smaller than 2000 bits so a second getflag was done.

    $ gp -q
    
    GP/PARI> modexp(a, b, n) = { \
        my(d, bin); \
        d = Mod(1, n); \
        bin = binary(b); \
        for (i = 1, length(bin), \
             d = sqr(d); \
             if (bin[i] == 1, \
                 d = d*a; \
             ); \
        ); \
        return(d);
    }
    
    GP/PARI> l(x, n) = (x - 1) \ n
    (x,n)->(x-1)\n
    
    GP/PARI> c = 7081712182161291422728776565674843368421208227308856147599959508943597073771616083159000708877404537908608602541428464149382089851205466964528950992320356865653909467834252215049638945622696111307334792547874755205654275024838725532399096799204022595824973469169477605424748183537686859652539813880031275289035894545289395658033762730627554407460132118626305018076424075525697416625021258302808140015171283031616251570355922852888143852282663757047745656930590372458652069779745085049342684845999753718449563933275374199717740340310986791099674969181003176584785833242843983131706709896574731829076614713019636870764;
    
    GP/PARI> factor(c, 10^8)
    
    [2 2]
    
    [10853 1]
    
    [163127987242266917505039541271419040090786147316614211453053522273647771901124483625702587046839688056496097911670240121380772363659943494069127222710779435770153631895196079771713787561565836895497438324607821689985586359182685099336568156251820293831774013387300230476014654554908478292926836217636397200982122328971007916199063916212741970134067357381053741317525662847270280489842008161402564728995929305989501786841332416218744675487944894431211316155224140156146965580478786626954360196397303826556011331734897590521462737038399216601393047295241020376503866056455449717398569747917044407746167297360629247 1]
    
    GP/PARI> log(163127987242266917505039541271419040090786147316614211453053522273647771901124483625702587046839688056496097911670240121380772363659943494069127222710779435770153631895196079771713787561565836895497438324607821689985586359182685099336568156251820293831774013387300230476014654554908478292926836217636397200982122328971007916199063916212741970134067357381053741317525662847270280489842008161402564728995929305989501786841332416218744675487944894431211316155224140156146965580478786626954360196397303826556011331734897590521462737038399216601393047295241020376503866056455449717398569747917044407746167297360629247)/log(2)
    2030.4040702971108427302282212943469829
    
    GP/PARI> c = 13911437984368101560480458625468708227228710564108218218829618494744917352807228729660572449487677038593974144238965248093813201390684188736256167632255948407887369582389677270404770938909688375469462067373313664900041074894537913364096676356299666814954476228507315787479175396870457317827890270751759376060125078887546912937363525758526139963483590262583417155387816946240014660815637447113994889915380934023260430678951591254418982156712042041192727183005422290582215699656439252357531699928685241520979142428868921643057589157751067668315612281186270596871270963367885913631448845185285789883899553142703497960463;
    
    GP/PARI> factor(c, 10^8)
    
    [43759 1]
    
    [151667 1]
    
    [18049349 1]
    
    [116132024323457094571330543406887656689880605607462973436783570657002627064631182020404516922341378754371202964765730569277877702515441914257099488804125212478352026987440543274836064475069960415663342761118462237682276189879849485135057256312407117279079732356350348785317356278706933730959386546070352345637198092078821082037381284008796112911278718341073849929539800177985285587503526829635367828032687298811081847884333550318822462302934313436396316116775238819665006944733915611260769795934959968371085560475215856122848967100467756196645826273257812261428998202641931228323933594405182808098079 1]
    
    GP/PARI> log(116132024323457094571330543406887656689880605607462973436783570657002627064631182020404516922341378754371202964765730569277877702515441914257099488804125212478352026987440543274836064475069960415663342761118462237682276189879849485135057256312407117279079732356350348785317356278706933730959386546070352345637198092078821082037381284008796112911278718341073849929539800177985285587503526829635367828032687298811081847884333550318822462302934313436396316116775238819665006944733915611260769795934959968371085560475215856122848967100467756196645826273257812261428998202641931228323933594405182808098079) / log(2)
    1990.0506946991552523961922289344228304
    
    GP/PARI> m_43759 = 28593425478267493242206468038704717466635277432585884624592568138590060696281788267295292693929585100809942270800928347900168014946717979919948559346920872628272096193951661239673963109903942403224433139005220490265854540131632437404391108504652879604584388280760299764521478905048034271904489548162148077258;
    
    GP/PARI> m_151667 = 28294757983311484390305954279736738682626116396678093939397734516137823127402696962374694018073785409132784257328389537132386261264290616530047924311793885953253219469688207025262056295418176929259644183597083458882655684343750657764181971035828894014427533539343448409475942958308103130268589502466250148469;
    
    GP/PARI> m_18049349 = 119003953228566347195464078434165387149756438171510761436259977130960825650452214550300407298898349423358291276893255020327854588400981662750533690446833603297603489788254114560369834422364311308231233941278290855295835692267983003540510825081169780229262345955998122060364568777573780137830671908355090666267;
    
    GP/PARI> m_large = 98071050004829417147178139318350985823771395925076367950924688772571412781658916003818420257630105841890625875295454236327596003183490844605269137737651747256032367444999345977515143368617519163190793395549844634585199719017634210382948030817115379958263506346295387265012883968136666827481798662789564334482;
    
    GP/PARI> n = 136981593347487370987577320035478914561394613962925553975587484279130061127897807891894407134265912887595821840159013570844002433897740551902899655921600054567580586448446664401410498598151974901953052329715219719514772817880500154545956487519270505448885340956960921808358942399917837223819160908982980638833;
    
    GP/PARI> m = lift(Mod(m_43759 + m_151667 + m_18049349 + m_large, n))
    118960400225922908767092208475413882656989809230909919847227803807091948810
    
    GP/PARI> strchr(digits(m, 256))
    "CTF{homomorphisms_for_the_win}\n"

